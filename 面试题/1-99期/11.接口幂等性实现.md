避免重复请求导致的业务重复处理。



#### 1. 重复请求场景案例

---

1. 客户第一次请求后，网络异常导致收到请求执行逻辑但是没有返回给客户端，客户端重新发起请求；
2. 客户端顺序点击按钮提交。

>对于==查询==：属于只读性质的那种业务必然符合幂等性要求。
>
>对于==删除==：重复做删除请求至少不会造成数据杂乱，不过也有写场景更希望重复点击提示的是删除成功，而不是目标不存在的信息。
>
>对于新增和修改：==新增，需要避免重复插入==；==修改，避免进行无效的重复修改==。



#### 2. 幂等性实现方式

---

客户端做某一请求的时候带上识别参数标识，服务端对此标识进行识别，重复请求则重复返回第一次的结果即可。

>对于客户端交互的接口，可以在前端拦截一部分，例如==防止表单重复提交==，==按钮置灰==，==隐藏==，==不可点击==等方式。

> 1. ==数据库去重表==：利用唯一索引特性，保证数据唯一
>
> 2. ==状态机==：很多业务中多有多个状态，比如订单的状态有提交、待支付、已支付、取消、退款等等状态。后端可以根据不同的状态去保证幂等性，比如在退款的时候，一定要保证这笔订单是已支付的状态。
>
> 3. TOKEN机制：调用方在调用接口的时候先向后端请求一个全局ID（TOKEN），请求的时候携带这个全局ID一起请求，后端需要对这个全局ID校验来保证幂等性等操作。
>
>    <img src="https://tva1.sinaimg.cn/large/008i3skNgy1gq0mdp5ixyj30hs09j0sw.jpg" style="zoom:100%">

利用jmeter测试工具模拟200个并发请求, 将上一步获取到的token作为参数。