#### 功能架构

---

<img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gm16y770wej314y0u0tcd.jpg" style="zoom:50%">

>三层：
>
>1. ==API接口层==：通过API操作数据库。接口层一收到调用请求就会调用数据处理层来完成具体的数据处理。
>2. ==数据处理层==：负责具体的<u>SQL查找</u>、<u>SQL解析</u>、<u>SQL执行</u>和<u>执行结果映射处理</u>等。它主要的目的是根据调用的请求完成一次数据库操作。
>3. ==基础支撑层==：<u>连接管理</u>、<u>事务管理</u>、<u>配置加载</u>和<u>缓存处理</u>，为上层的数据处理提供基础支撑。



#### 1. SqlSessionFactory

---

>每一个Mybatis应用程序的入口是SqlSessionFactoryBuilder。
>
>- 通过XML配置文件创建Configuration对象（也可直接在代码中创建）；
>- 调用build()方法创建SqlSessionFactory对象。
>- 通常创建一个全局SqlSessionFactory对象就可以了。
>
>```java
>public static SqlSessionFactory getSqlSessionFactory() {
>   // 1.构建数据库连接池
>   PooledDataSource dataSource = new PooledDataSource();
>   dataSource.setDriver("com.mysql.jdbc.Driver");
>   dataSource.setUsername("root");
>   dataSource.setPassword("539976");
>   dataSource.setUrl("jdbc:mysql://localhost:3306/test");
>   dataSource.setDefaultAutoCommit(false);
>
>   // 2.构建数据库事务方式
>   JdbcTransactionFactory transactionFactory = new JdbcTransactionFactory();
>
>   // 3.创建数据库运行环境
>   Environment environment = new Environment("development", transactionFactory, dataSource);
>
>   Configuration configuration = new Configuration(environment);
>   configuration.getTypeAliasRegistry().registerAlias("blog", Blog.class);
>   configuration.addMapper(BlogMapper.class);
>
>   SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(configuration);
>
>   return sqlSessionFactory;
>}
>```



#### 2. SqlSessionFactory

---

>SqlSessionFactory用来创建SqlSession对象。
>
>- SqlSessionFactory对象的一个必要的属性是Configuration对象（保存Mybatis全局配置的对象）
>- 通常创建一个全局的SqlSessionFactory对象就行了。

<img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gm19erefi9j30qe02w0sr.jpg" style="zoom:60%">



#### 3.SqlSession

---

>SqlSession对象主要功能是完成一次数据库的访问和结果的映射。
>
>- 类似于数据库的session概念。
>- 线程不安全，所以SqlSession对象的作用域需限制在方法内。
>- SqlSession默认实现类是DefaultSqlSession，有两个必须配置的属性：Configuration和Excutor。

<img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gm19k29g2hj30kc080dg3.jpg" style="zoom:60%">

>==SqlSession==：默认创建DefaultSqlSession并且开启一级缓存，创建执行器、赋值。
>
>SqlSession有一个重要的方法getMapper，顾名思义，这个方式是用来获取Mapper对象的。什么是Mapper对象？根据Mybatis的官方手册，应用程序除了要初始并启动Mybatis之外，还需要定义一些接口，接口里定义访问数据库的方法，存放接口的包路径下需要放置同名的XML配置文件。
>
>SqlSession的getMapper方法是联系应用程序和Mybatis纽带，应用程序访问getMapper时，Mybatis会根据传入的接口类型和对应的XML配置文件生成一个代理对象，这个代理对象就叫Mapper对象。应用程序获得Mapper对象后，就应该通过这个Mapper对象来访问Mybatis的SqlSession对象，这样就达到里插入到Mybatis流程的目的。



#### 4. Excutor

---

>*<u>Executor对象在创建Configuration对象的时候创建</u>*，并且缓存在Configuration对象里。
>
>Executor对象的主要功能是==调用StatementHandler访问数据库==，并将查询结果存入缓存中（如果配置了缓存的话）。



#### 5. StatementHandler

---

>StatementHandler是真正访问数据库的地方，并调用ResultSetHandler处理查询结果。如下查询方法：
>
>```java
>public <E> List<E> query(Statement statement, ResultHandler resultHandler) throws SQLException {
>String sql = boundSql.getSql();
>// 执行sql
>statement.execute(sql);
>// 调用ResultSetHandler处理查询结果
>return resultSetHandler.handleResultSets(statement);
>}
>```



#### 6. ResultSetHandler

---

>处理查询结果。



#### 7. Mybatis 成员层次 & 职责

---

<img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gm1adk10w1j30tk10utbb.jpg" style="zoom:60%">

>1. SqlSession 作为MyBatis工作的主要顶层API，表示和数据库交互的会话，完成必要数据库增删改查功能
>
>2. Executor MyBatis执行器，是MyBatis 调度的核心，负责SQL语句的生成和查询缓存的维护
>
>3. StatementHandler 封装了JDBC Statement操作，负责对JDBCstatement的操作，如设置参数、将Statement结果集转换成List集合。
>
>4. ParameterHandler 负责对用户传递的参数转换成JDBC Statement 所需要的参数
>
>5. ResultSetHandler *负责将JDBC返回的ResultSet结果集对象转换成List类型的集合；
>
>6. TypeHandler 负责java数据类型和jdbc数据类型之间的映射和转换
>
>7. MappedStatement MappedStatement维护了一条<select|update|delete|insert>节点的封
>
>8. SqlSource 负责根据用户传递的parameterObject，动态地生成SQL语句，将信息封装到BoundSql对象中，并返回
>
>9. BoundSql 表示动态生成的SQL语句以及相应的参数信息
>
>10. Configuration MyBatis所有的配置信息都维持在Configuration对象之中


