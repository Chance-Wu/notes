### 一、添加依赖

```xml
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-web</artifactId>
</dependency>
```



### 二、将RestTemplate配置初始化为一个Bean

创建RestTemplateConfig类，设置连接池大小、超时时间、重试机制等。配置如下：

```java
@Configuration
public class RestTemplateConfig {

  @ConditionalOnMissingBean(RestTemplate.class)
  @Bean
  public RestTemplate restTemplate(){
    RestTemplate restTemplate = new RestTemplate();
    return restTemplate;
  }
}
```

注意，这种初始化方法，是使用了JDK自带的`HttpURLConnection`作为底层HTTP客户端实现。

当然，我们还可以修改RestTemplate默认的客户端，例如将其改成`HttpClient`客户端，方式如下：

```java
@Configuration
public class RestTemplateConfig {

  @ConditionalOnMissingBean(RestTemplate.class)
  @Bean
  public RestTemplate restTemplate(){
    RestTemplate restTemplate = new RestTemplate(getClientHttpRequestFactory());
    return restTemplate;
  }

  /**
   * 使用HttpClient作为底层客户端
   * @return
   */
  private ClientHttpRequestFactory getClientHttpRequestFactory() {
    int timeout = 5000;
    RequestConfig config = RequestConfig.custom()
      .setConnectTimeout(timeout)
      .setConnectionRequestTimeout(timeout)
      .setSocketTimeout(timeout)
      .build();
    CloseableHttpClient client = HttpClientBuilder
      .create()
      .setDefaultRequestConfig(config)
      .build();
    return new HttpComponentsClientHttpRequestFactory(client);
  }

}
```

#### 3. 发送GET请求

```java
// 1-getForObject()
String response = restTemplate.getForObject(url , String.class);
System.out.println(response);

// 2-getForEntity()
ResponseEntity<String> responseEntity1 = restTemplate.getForEntity(url, String.class);
HttpStatus statusCode = responseEntity1.getStatusCode();
HttpHeaders header = responseEntity1.getHeaders();
String response2 = responseEntity1.getBody();
System.out.println(response2);

// 3-exchange()
RequestEntity requestEntity = RequestEntity.get(new URI(url)).build();
ResponseEntity<String> responseEntity2 = restTemplate.exchange(requestEntity, String.class);
String response3 = responseEntity2.getBody();
System.out.println(response3);
```

#### 4.发送POST请求

```java
// 1-postForObject()
User user1 = this.restTemplate.postForObject(uri, user, User.class);

// 2-postForEntity()
ResponseEntity<User> responseEntity1 = this.restTemplate.postForEntity(uri, user, User.class);

// 3-exchange()
RequestEntity<User> requestEntity = RequestEntity.post(new URI(uri)).body(user);
ResponseEntity<User> responseEntity2 = this.restTemplate.exchange(requestEntity, User.class);
```

#### 5. 设置HTTP Header

```java
// 1-Content-Type
RequestEntity<User> requestEntity = RequestEntity
    .post(new URI(uri))
    .contentType(MediaType.APPLICATION_JSON)
    .body(user);

// 2-Accept
RequestEntity<User> requestEntity = RequestEntity
    .post(new URI(uri))
    .accept(MediaType.APPLICATION_JSON)
    .body(user);

// 3-Other
RequestEntity<User> requestEntity = RequestEntity
    .post(new URI(uri))
    .header("Authorization", "Basic " + base64Credentials)
    .body(user);
```

#### 6. 发送文件

```java
@RequestMapping(value="/sendFile")
public String sendFile() throws URISyntaxException, IOException {
    MultiValueMap<String, Object> multiPartBody = new LinkedMultiValueMap<>();
    multiPartBody.add("file", new ClassPathResource("tmp/user.txt"));
    RequestEntity<MultiValueMap<String, Object>> requestEntity = RequestEntity
        .post(new URI("http://127.0.0.1:8080/upload1"))
        .contentType(MediaType.MULTIPART_FORM_DATA)
        .body(multiPartBody);
    ResponseEntity<String> response = restTemplate.exchange(requestEntity, String.class);
    return "sueecess";
}
```

#### 7. 下载文件

```java
/**
* 下载文件
* @param response
* @throws URISyntaxException
* @throws IOException
*/
@RequestMapping(value="/receiveFile")
public void receiveFile(HttpServletResponse response) throws URISyntaxException, IOException {
    // 小文件
    RequestEntity requestEntity = RequestEntity.get(
        new URI("http://127.0.0.1:8080/downLoad.html")).build();
    ResponseEntity<byte[]> responseEntity = restTemplate.exchange(requestEntity, byte[].class);
    byte[] downloadContent = responseEntity.getBody();
    response.reset();
    response.setHeader("Content-Disposition", "attachment; filename=\"myframe.html\"");
    response.addHeader("Content-Length", "" + downloadContent.length);
    response.setContentType("application/octet-stream; charset=UTF-8");
    IOUtils.write(downloadContent, response.getOutputStream());
}

/**
* 大文件
* @param response
* @return
* @throws URISyntaxException
*/
@RequestMapping(value="/bigFile")
public String bigFile(HttpServletResponse response) throws URISyntaxException {
    //大文件
    ResponseExtractor<ResponseEntity<File>> responseExtractor =
        new ResponseExtractor<ResponseEntity<File>>() {
        @Override
        public ResponseEntity<File> extractData(ClientHttpResponse response)
            throws IOException {
            File rcvFile = File.createTempFile("rcvFile", "zip");
            FileCopyUtils.copy(response.getBody(), new FileOutputStream(rcvFile));
            return ResponseEntity.status(response.getStatusCode()).
                headers(response.getHeaders()).body(rcvFile);
        }
    };
    RequestCallback requestCallback = new RequestCallback() {
        @Override
        public void doWithRequest(ClientHttpRequest clientHttpRequest) throws IOException {

        }
    };
    ResponseEntity<File> fileBody = this.restTemplate.execute(
        new URI("http://127.0.0.1:8080/downLoad.html"),
        HttpMethod.GET,  requestCallback, responseExtractor);
    File file = fileBody.getBody();
    file.renameTo(new File("D:/Users/big.hmtl"));
    return "success";
}
```



```java
@Test
public void testGetWithHeaders(){
  HttpHeaders headers = new HttpHeaders();
  headers.setContentType(MediaType.APPLICATION_JSON);
  Map<String,Integer> map = new HashMap<String,Integer>();
  map.put("pageNum",1);
  map.put("pageSize",15);
  HttpEntity<MultiValueMap> httpEntity = new HttpEntity<>(null, headers);
  //get请求
  String newUrl = "https://xxxxxxx.com:8101/operate/operate_pay/getOperatesPay?pageNum="+1+"&pageSize="+15;
  ResponseEntity<String> responseEntity = restTemplate.exchange(newUrl, HttpMethod.GET, httpEntity, String.class);
  String body = responseEntity.getBody();
  System.err.println(body);
}
```

