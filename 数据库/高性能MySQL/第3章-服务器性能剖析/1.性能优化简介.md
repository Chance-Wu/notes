>- 如何确认服务器是否达到了性能最佳的状态
>- 找出某条语句为什么执行不够快
>- 诊断被用户描述成”停顿“、”堆积“或者“卡死”的某些间歇性疑难故障
>
>将性能定义为完成某件任务所需要的时间度量，==性能即响应时间==。我们通过任务和事件而不是资源来测量性能。
>
>数据库服务器的目的是执行SQL语句，所以它关注的任务是查询或者语句，如SELECT、UPDATE、DELETE等。数据库服务器的性能用查询的响应时间来度量，单位是每个查询花费的时间。

#### 1. 通过性能剖析进行优化

>一旦掌握并实践面向响应时间的优化方法，就会发现需要不断地对系统进行性能剖析（profiling）。
>
>性能剖析是测量和分析时间花费在哪里的主要方法。性能剖析一般有两个步骤：
>
>- 测量任务所花费的时间；
>- 然后对结果进行统计和排序，将重要的任务排到前面。

>性能剖析工具的工作方式基本相同。在任务开始时启动计时器，在任务结束时停止计时器，然后用结束时间减去启动时间得到响应时间。也有些工具会记录任务的父任务。这些结果数据可以用来绘制调用关系图，但对于我们的目标来说更重要的是，可以将相似的任务分组并进行汇总。对相似的任务分组并进行汇总可以帮助对那些分到一组的任务做更复杂的统计分析，但至少需要知道每一组有多少任务，并计算出总的响应时间。通过性能剖析报告（profile report）可以获得需要的结果。
>
>性能剖析报告会列出所有任务列表。<u>每行记录一个任务，包括任务名、任务的执行时间、任务的消耗时间、任务的平均执行时间，以及该任务执行时间占全部时间的百分比</u>。性能剖析报告会按照任务的消耗时间进行降序排序。
>
>下面输出是用`Percona Toolkit`中的`p-query-digest`（分析得到的结果。为了显示方便，对结果做了一些微调，并且只截取了前面几行结果：
>
>```
>Rank Response time Calls R/Call Item 
>==== ================ ===== ====== =======  
>1 11256.3618 68.1% 78069 0.1442 SELECT InvitesNew  
>2 2029.4730 12.3% 14415 0.1408 SELECT StatusUpdate  
>3 1345.3445 8.1% 3520 0.3822 SHOW STATUS
>```
>
>每一行都包括了查询的响应时间和占总时间的百分比、查询的执行次数、单次执行的平均响应时间，以及该查询的摘要。在这个例子中，任务指的就是查询，实际上在分析MySQL的时候经常都指的是查询。
>
>讨论两种类型的性能剖析：基于执行时间的分析和基于等待的分析。
>
>事实上，当基于执行时间的分析发现一个任务需要花费太多时间的时候，应该深入去分析一下，可能会发现某些“执行时间”实际上是在等待。例如，上面简单的性能剖析的输出显示表InvitesNew上的SELECT查询花费了大量时间，如果深入研究，则可能发现时间都花费在等待I/O完成上。

#### 2. 理解性能剖析

>MySQL的性能剖析（profile）将最重要的任务展示在前面，但有时候没显示出来的信息也很重要。如下：
>
>- 值得优化的查询
>- 异常情况
>
>pt-query-digest就在剖析的结果里包含了很多这类信息，并且输出在剖析报告中。