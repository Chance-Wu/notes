- `DispatcherServlet`是SpringMVC的一个前端控制器，是MVC架构中的controller的实现，==用于拦截这个web应用的所有请求==，具体为在web.xml中配置这个servlet，对应的url-pattern设置为“/”，或者==使用servlet3.0之后的WebApplicationInitializer来配置==，在web容器启动这个应用时，会创建和初始化这个DispatcherServlet对象实例。
- DispatcherServlet会根据请求的uri信息，找到对应的某个controller的某个方法来处理这个请求。通常在controller对应的类中使用@Controller和@RequestMapping来唯一确定类的一个方法处理哪些uri请求，具体包括路径，http请求方法等信息。同时还需要处理主题theme，本地化locale，multipart请求，以及响应到View视图的映射。
- 基于以上需求背景，DispatcherServlet需要定义相关的子组件来完成这些功能。由于Spring的ApplicationContext体系结构设计当中是支持层次化的，即整个spring应用包含一个root WebApplicationContext，多个子WebApplicationContext，子WebApplicationContext共享这个root WebApplicationContext。每个DispatcherServlet可以使用一个独立的，只与这个DispatcherServlet实例绑定的WebApplicationContext来创建和管理这些子组件。



### 一、DispatcherServlet的类结构设计

---

- DispatcherServlet既是servlet规范中的一个普通的servlet，在service方法中定义对请求的处理；
- 又通过spring的WebApplicationContext来管理其相关的子组件bean，并在自身中维护对spring容器中的子组件bean的引用，从而方便调用。

所以在DispatcherServlet类结构设计当中，需要考虑着两个方面的设计，如图：

![](https://tva1.sinaimg.cn/large/008i3skNgy1gtn029rbdcj61ek0judi402.jpg)

DispatcherServlet -> FrameworkServlet -> HttpServletBean



#### 1.1 HttpServletBean

---

继承于HttpServlet，实现了EnvironmentAware（注入Environment对象）和EnvironmentCapable（访问Environment对象）接口，其中Environment主要从类路径的属性文件，运行参数，@PropertySource注解等获取应用的相关属性值，以提供给spring容器相关组件访问，或者写入属性到Environment来给其他组件访问。

>HttpServletBean的主要作用就是将该servlet相关的init-param，封装成bean属性，然后保存到Environment当中，从而可以在spring容器中被其他bean访问。



#### 1.2 FrameworkServlet

---

继承于HttpServletBean，因为DispatcherServlet通常包含一个独立的WebApplication，而普通的servlet则只是通过servletContext获取spring容器的root WebApplicationContext，从而从中获取相关bean，所以在DispatcherServlet类层次结构中，增加FrameworkServlet这层设计。作用就是用于获取，创建与管理，DispatcherServlet所绑定的WebApplicationContext对象，即完成WebApplicationContext的创建相关的：

- 从contextConfigLocation获取xml或WebApplicationInitializer配置信息，根据contextClass创建WebApplicationContext；
- 以及获取ApplicationContextInitializer来对WebApplicationContext进行初始化；
- 最后==调用refresh完成DispatcherServlet绑定的这个WebApplicationContext的创建==。









































































































