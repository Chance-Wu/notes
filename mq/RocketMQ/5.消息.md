### 一、定义

---

生产者将业务数据的负载和拓展属性包装成消息发送到 Apache RocketMQ 服务端，服务端按照相关语义将消息投递到消费端进行消费。

Apache RocketMQ 的消息模型具备如下特点：

- **消息不可变性**

  消息本质上是已经产生并确定的事件，一旦产生后，消息的内容不会发生改变。即使经过传输链路的控制也不会发生变化，消费端获取的消息都是只读消息视图。

- **消息持久化**

  Apache RocketMQ 会默认对消息进行持久化，即将接收到的消息存储到 Apache RocketMQ 服务端的存储文件中，保证消息的可回溯性和系统故障场景下的可恢复性。



### 二、模型关系

---

![消息](img/archiforqueue-dd6788b33bf2fc96b4a1dab83a1b0d71-20240906161707326.png)

1. 消息由生产者初始化并发送到Apache RocketMQ 服务端。
2. 消息按照到达Apache RocketMQ 服务端的顺序存储到队列中。
3. 消费者按照指定的订阅关系从Apache RocketMQ 服务端中获取消息并消费。



### 三、消息内部属性

---

#### 3.1 消息保留属性

#### 3.2 主题名称

当前消息所属的主题的名称。集群内全局唯一。

- 取值：从客户端SDK接口获取。

#### 3.3 消息类型

当前消息的类型。

- 取值：从客户端SDK接口获取。Apache RocketMQ 支持的消息类型如下：
  - Normal：[普通消息](https://rocketmq.apache.org/zh/docs/featureBehavior/01normalmessage)，消息本身无特殊语义，消息之间也没有任何关联。
  - FIFO：[顺序消息](https://rocketmq.apache.org/zh/docs/featureBehavior/03fifomessage)，Apache RocketMQ 通过消息分组MessageGroup标记一组特定消息的先后顺序，可以保证消息的投递顺序严格按照消息发送时的顺序。
  - Delay：[定时/延时消息](https://rocketmq.apache.org/zh/docs/featureBehavior/02delaymessage)，通过指定延时时间控制消息生产后不要立即投递，而是在延时间隔后才对消费者可见。
  - Transaction：[事务消息](https://rocketmq.apache.org/zh/docs/featureBehavior/04transactionmessage)，Apache RocketMQ 支持分布式事务消息，支持应用数据库更新和消息调用的事务一致性保障。

#### 3.4 消息队列

实际存储当前消息的队列。

- 取值：由服务端指定并填充。

#### 3.5 消息位点

当前消息存储在队列中的位置。

- 取值：由服务端指定并填充。取值范围：0~long.Max。

#### 3.6 消息ID

消息的唯一标识，集群内每条消息的ID全局唯一。

- 取值：生产者客户端系统**自动生成**。**固定为数字和大写字母组成的32位字符串**。

#### 3.7 索引Key列表（可选）

消息的索引键，可通过设置不同的Key区分消息和快速查找消息。

- 取值：由生产者客户端定义。

#### 3.8 过滤标签Tag（可选）

消息的过滤标签。消费者可通过Tag对消息进行过滤，仅接收指定标签的消息。

- 取值：由生产者客户端定义。
- 约束：一条消息仅支持设置一个标签。

#### 3.9 定时时间（可选）

定时场景下，消息触发延时投递的毫秒级时间戳。

- 取值：由消息生产者定义。
- 约束：最大可设置定时时长为40天。

#### 3.10 消息发送时间

消息发送时，生产者客户端系统的本地毫秒级时间戳。

- 取值：由生产者客户端系统填充。
- 说明：客户端系统时钟和服务端系统时钟可能存在偏差，消息发送时间是以客户端系统时钟为准。

#### 3.11 消息保存时间戳

消息在Apache RocketMQ 服务端完成存储时，服务端系统的本地毫秒级时间戳。 对于定时消息和事务消息，消息保存时间指的是消息生效对消费方可见的服务端系统时间。

- 取值：由服务端系统填充。
- 说明：客户端系统时钟和服务端系统时钟可能存在偏差，消息保留时间是以服务端系统时钟为准。

#### 3.12 消费重试次数

消息消费失败后，Apache RocketMQ 服务端重新投递的次数。每次重试后，重试次数加1。

- 取值：由服务端系统标记。首次消费，重试次数为0；消费失败首次重试时，重试次数为1。

#### 3.13 业务自定义属性

生产者可以自定义设置的扩展信息。

- 取值：由消息生产者自定义，按照字符串键值对设置。

#### 3.14 消息负载

业务消息的实际报文数据。

- 取值：由生产者负责序列化编码，按照二进制字节传输。



### 四、行为约束

---

消息大小不得超过其类型所对应的限制，否则消息会发送失败。

系统默认的消息最大限制如下：

- 普通和顺序消息：4 MB
- 事务和定时或延时消息：64 KB