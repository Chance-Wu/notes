#### 启动

---

```sh
/usr/local/nginx/nginx
```

#### 从容停止

---

等所有请求结束后关闭服务。

```sh
ps -ef | grep nginx

kill -QUIT nginx主进程号
```

#### 快速停止

---

```sh
ps -ef |grep nginx

kill -TERM nginx主进程号
```

>如果以上命令不管用，直接强制停止：
>
>```sh
>kill -9 nginx主进程号
>```

#### 重启

---

1. 简单型，先关闭进程，修改配置后，重启进程。
2. 重新加载配置文件，不重启进程，不会停止处理请求。
3. 平滑更新nginx二进制，不会停止处理请求。

##### 使用信号加载新的配置

```sh
nginx -t -c /etc/nginx/nginx.conf

ps aux | egrep '(PID|nginx)'

kill -HUP nginx主进程号
```

>当 nginx 接收到**HUP**信号，它会尝试先解析配置文件（如果指定配置文件，就使用指定的，否则使用默认的），成功的话，就应用新的配置文件（例如：重新打开日志文件或监听的套接字）。之后，nginx 运行新的工作进程并从容关闭旧的工作进程。通知工作进程关闭监听套接字但是继续为当前连接的客户提供服务。所有客户端的服务完成后，旧的工作进程被关闭。 如果新的配置文件应用失败，nginx 将继续使用旧的配置进行工作。

##### 平滑升级到新的二进制代码

可以在不中断服务的情况下（新的请求也不会丢失），使用新的 nginx 可执行程序替换旧的。

首先，使用新的可执行程序替换旧的（最好做好备份），然后，发送 **USR2** 信号给主进程。

```sh
kill -USR2 nginx主进程号
```

主进程将重命名它的 **.pid** 文件为 **.oldbin** (比如：**/usr/local/nginx/logs/nginx.pid.oldbin**)，然后执行新的可执行程序，依次启动新的主进程和新的工作进程。

此时，两个nginx实例会同时运行，一起处理输入的请求。要逐步停止旧的实例，必须发送WINCH信号给旧的主进程，然后，它的工作进程就将开始从容关闭。

一段时间后，旧的工作进程处理了所有已连接的请求后退出，就仅由新的工作进程来处理输入的请求了。

>这时，因为旧的服务器还尚未关闭它监听的套接字，所以，通过下面的几步，你仍可以恢复旧的服务器：
>
>- 发送 HUP 信号给旧的主进程 - 它将在不重载配置文件的情况下启动它的工作进程
>- 发送 QUIT 信号给新的主进程，要求其从容关闭其工作进程
>- 发送 TERM 信号给新的主进程，迫使其退出
>- 如果因为某些原因新的工作进程不能退出，向其发送 KILL 信号
>
>新的主进程退出后，旧的主进程会由移除 **.oldbin** 前缀，恢复为它的 **.pid** 文件，这样，一切就都恢复到升级之前了。
>
>如果尝试升级成功，而你也希望保留新的服务器时，发送 QUIT 信号给旧的主进程使其退出而只留下新的服务器运行。