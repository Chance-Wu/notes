### 一、进程

---

#### 1.1 多道程序设计

允许多个程序同时进入内存并运行，提高CPU的利用率，目的是提高系统效率。

![](img/aHR0cHM6Ly9hc2sucWNsb3VkaW1nLmNvbS9odHRwLXNhdmUvMTc1MjMyOC9xbW1pYW9yb2phLnBuZw.png)

a图内存中有四个程序，串行执行，因为这里只有一个程序计数器。

当有了**多道程序技术**之后就得到了b图，**每个程序各自独立的占用一个逻辑程序计数器**，达到并发执行效果。

从c图中可以看到多个程序是轮流执行的。

#### 1.2 并发环境与并发程序

并发环境指一段时间间隔内，单处理器上有两个或两个以上的程序同时处于开始运行但尚未结束的状态，并且次序不是事先确定的。在并发环境下执行的程序就是并发程序。

#### 1.3 定义

进程是具有独立功能的程序关于某个数据集合上的一次运动活动，是**系统进行资源分配和调度的独立单位**。

- 进程是程序的一次执行过程，一个程序执行多次那是不同的进程；
- 是正在运行的程序的抽象，或者说是对CPU的一个抽象；
- 将一个CPU变换成多个虚拟的CPU；
- 系统资源以进程为单位分配，如内存、文件等，**操作系统为每个独立的进程分配了独立的地址空间**；
- 操作系统将CPU调度给需要的进程，即将CPU的控制权交给某个进程就称为调度。

#### 1.4 特征

- 结构性：**由数据段、程序段、PCB构成**
- 动态性：可以被动态地创建、执行、撤销
- 并发性：同一时间内有多个进程在运行
- 独立性：独立运行以及获得OS资源的基本单位
- 异步性：异步执行

组成 

1. 程序：描述进程要完成的功能 。
2. 数据集合：程序在执行时所需要的数据和工作区。 
3. 程序控制块PCB：包含进程的描述信息和控制信息。它是进程存在的唯一标志。

> **进程控制块-PCB**
>
> - 又称进程描述符或进程属性
> - 操作用于管理控制进程的一个专门的数据结构
> - 记录进程的各种属性，描述进程的动态变化过程
> - PCB是系统感知进程存在的唯一标志：进程与PCB一一对应
> - 进程表：所以进程的PCB集合。进程表的大小往往固定，这也决定了一个操作系统最多支持多少进程，有时我们称为系统支持的并发度
>
> **PCB中需要保存的信息**
>
> 1. 进程描述信息
>    - 进程标识符（`process id`），这个标识是唯一的，通常是一个整数
>    - 进程名，通常基于可执行文件名，这是不唯一的
>    - 用户标识符（`user id`）
>    - 进程组关系
>
> 2. 进程控制信息
>
>    - 当前状态
>
>    - 优先级
>
>    - 代码执行入口地址
>
>    - 程序的磁盘地址
>
>    - 运行统计信息（执行时间、页面调度）
>
>    - 进程间同步和通信
>
>    - 进程的队列指针
>
>    - 进程的消息队列指针
>
> 3. 所拥有的资源和使用情况
>    - 虚拟地址空间的使用状况
>    *   打开的文件列表
> 4. CPU线程信息，这是当CPU不运行的时候操作系统需要把一些重要的信息记录下来
>    - 寄存器值（通用寄存器、程序计数器`PC`、程序状态字`PSW`、栈指针）
>    - 指向该进程页表的指针

![](img/aHR0cHM6Ly9hc2sucWNsb3VkaW1nLmNvbS9odHRwLXNhdmUvMTc1MjMyOC9xNnF4a2hlbzlhLnBuZw.png)



### 二、进程状态及状态的转换（重点）

---

#### 2.1 进程的三种基本状态

| 进程基本状态 |                                                              |
| ------------ | ------------------------------------------------------------ |
| 运行态       | 占用CPU，并在CPU上运行                                       |
| 就绪态       | 已经具备运行条件，但由于没有空闲CPU，而且暂时不能运行        |
| 等待态       | 因等待某一事件而暂时不能运行，如等待读盘结果。又称为阻塞态、封锁态、睡眠态 |

![](img/aHR0cHM6Ly9hc2sucWNsb3VkaW1nLmNvbS9odHRwLXNhdmUvMTc1MjMyOC9xY3ljMzZ3M2JmLnBuZw.png)

#### 2.2 进程的其他状态

- 创建态：已完成创建一个进程所必要的工作，如`PID、PCB`。但尚未同意执行该进程，因为资源有限
- 终止态：终止执行后，进程进入该状态。可完成一些数据统计工作。资源回收。
- 挂起态：用于调节负载，进程不占用内存空间，其进程映像交换到磁盘上。

#### 2.3 五状态模型

![](img/aHR0cHM6Ly9hc2sucWNsb3VkaW1nLmNvbS9odHRwLXNhdmUvMTc1MjMyOC9xam0zdDJ0MWhxLnBuZw.png)

#### 2.4 七状态模型

![img](img/70)

- 挂起状态的进程不能直接被CPU调度执行
- 挂起状态进程也许在等在某个事件，也可能不在等待某个事件。如果挂起的进程正在等待某个事件，则**阻塞条件与挂起条件无关**，引起阻塞的事件发生也不会使得进程立即被执行
- 触发进程进入挂起状态的实体：可以是终端用户、也可以父进程、或OS
- 进程必须通过**激活**才能离开挂起状态

#### 2.5 Linux状态转换示意图

![](img/aHR0cHM6Ly9hc2sucWNsb3VkaW1nLmNvbS9odHRwLXNhdmUvMTc1MjMyOC95MTd0cWI1Z2VuLnBuZw.png)

这里使用fork()创建一个进程。浅度睡眠和深度睡眠不同在于前者在睡眠时会接收信号，而后者则不会。正在运行的程序可能因为调试断点出现一个暂停的状态。



### 三、进程队列

---

- 操作系统为每一类进程建立一个或多个队列
- 队列元素为`PCB`
- 伴随进程状态的改变，其`PCB`从一个队列进入另一个队列

![](img/aHR0cHM6Ly9hc2sucWNsb3VkaW1nLmNvbS9odHRwLXNhdmUvMTc1MjMyOC92MzhmZ3U2MjJlLnBuZw.png)

真实情况下，就绪态也是排多个队列。而等待态由于各自产生的原因（事件）不同而排不同的队列。

#### 3.1 五状态进程模型的队列模型

![](img/aHR0cHM6Ly9hc2sucWNsb3VkaW1nLmNvbS9odHRwLXNhdmUvMTc1MjMyOC94bnF4NDh1am84LnBuZw.png)



### 四、进程控制

---

进程控制操作完成进程各状态之间的转换，由具有特定功能的原语（其实就是程序，只是这些程序不许与被中断）完成。关于进程控制的原语如下：

- 进程创建原语
- 进程撤销原语
- 阻塞原语
- 唤醒原语
- 激活原语
- 改变进程优先级

**原语：**完成某种特定功能的一段程序，具有不可分割性或不可中断性，即原语的执行必须是连续的，在执行过程中不允许被中断。又称原子操作。

#### 4.1 进程的创建

- 给新进程分配一个**唯一标识**以及**进程控制块**（没有被使用的）；
- 为进程分配独立地址空间；
- 初始化进程控制块：设置默认值（如状态为New...）；
- 设置相应地队列指针。如：把新进程加到就绪队列链表中；
- 主要操作是UNIX中：`fork/exec`，Windows中：`CreateProcess`。

#### 4.2 进程的撤销

结束进程，主要完成的工作：

- 回收进程所占用的资源，如关闭打开的文件、断开网络连接、回收分配的内存等；
- 撤销该进程的PCB；
- 在UNIX中使用：`exit`，Windows中：`TerminateProcess`。

#### 4.3 进程阻塞

处于运行状态的进程，在其运行过程中期待某一事件发生，如等待键盘输入、等待磁盘数据传输完成、等待其他进程发送消息。当被等待的事件未发生时，由进程自己执行阻塞原语，使自己由运行态变为阻塞态。在UNIX中使用`wait`，在Windows中使用`WaitForSingleObject`。

































